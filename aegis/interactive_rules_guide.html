<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aegis Rules Guide</title>
    <!-- Load Rules Data -->
    <script src="rules_data.js"></script>
    <style>
        :root {
            --primary: #663399; /* Aegis Purple */
            --dark: #1a1a1a;
            --light: #f4f6f8;
            --text: #333;
            --border: #e1e4e8;
            --card-bg: #fff;
            --severity-high: #d93025;
            --severity-medium: #f9ab00;
            --severity-low: #1e8e3e;
        }
        
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            background-color: var(--light);
            color: var(--text);
            line-height: 1.6;
        }

        header {
            background: var(--dark);
            color: #fff;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 { margin: 0; font-size: 1.5rem; font-weight: 600; }
        .subtitle { font-size: 0.9rem; opacity: 0.8; }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        /* Search & Filter Bar */
        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            background: #fff;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s;
        }
        
        .search-box input:focus {
            border-color: var(--primary);
        }

        .filter-group {
            display: flex;
            gap: 0.5rem;
        }

        select {
            padding: 0.8rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: #fff;
            cursor: pointer;
        }

        /* Rules Grid */
        .rules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .rule-card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            overflow: hidden;
        }

        .rule-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: var(--primary);
        }
        
        .rule-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .rule-id {
            background: var(--dark);
            color: #fff;
            padding: 0.2rem 0.6rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .rule-severity {
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }
        
        .sev-high { color: var(--severity-high); background: rgba(217, 48, 37, 0.1); }
        .sev-medium { color: var(--severity-medium); background: rgba(249, 171, 0, 0.1); }
        .sev-low { color: var(--severity-low); background: rgba(30, 142, 62, 0.1); }

        .rule-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .rule-desc {
            font-size: 0.95rem;
            color: #555;
            margin-bottom: 1rem;
        }

        .rule-details {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
            font-size: 0.9rem;
        }

        .section-title {
            font-weight: 600;
            color: #555;
            margin-bottom: 0.3rem;
            margin-top: 0.8rem;
            display: block;
        }

        .code-block {
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            padding: 0.8rem;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
        }

        .code-bad { background: #fee; border-left: 3px solid #d93025; color: #a00; }
        .code-good { background: #eef9ee; border-left: 3px solid #1e8e3e; color: #006000; }
        
        .doc-link {
            display: inline-block;
            margin-top: 0.5rem;
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }
        
        .doc-link:hover { text-decoration: underline; }

    </style>
</head>
<body>

<header>
    <div>
        <h1>Aegis Rules Explorer</h1>
        <div class="subtitle">Interactive Documentation & Standards Guide</div>
    </div>
    <div style="font-size: 0.9rem;">v1.0.0</div>
</header>

<div class="container" style="margin-bottom: 0;">
    <div style="background: rgba(0, 161, 223, 0.05); border: 1px solid rgba(0, 161, 223, 0.2); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
        <h2 style="margin-top: 0; font-size: 1.1rem; color: var(--primary);">üöÄ Power Feature: Universal Trigger Engine</h2>
        <p style="font-size: 0.95rem; margin-bottom: 0.5rem;">
            Aegis now supports <strong>context-aware validation</strong>. Any check type (XML, POM, JSON, or Property) can be used as a 
            <em>precondition</em>. This allows you to enforce standards like "Only require JMS config if the JMS library is in the POM" or 
            "Enforce strict security only for Experience APIs."
        </p>
        <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
            <div style="background: #fff; padding: 0.5rem 1rem; border-radius: 4px; border: 1px dashed var(--primary); font-size: 0.8rem;">
                <strong>Cross-Platform Ready:</strong> Fully validated on Windows, Mac, and Linux (CloudHub).
            </div>
            <div style="background: #fff; padding: 0.5rem 1rem; border-radius: 4px; border: 1px dashed var(--primary); font-size: 0.8rem;">
                <strong>Alphanumeric IDs:</strong> Support for organizational-standard rule coding.
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="controls">
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Search rules (e.g., 'timeout', 'db', 'http')..." />
        </div>
        <div class="filter-group">
            <select id="typeFilter">
                <option value="ALL">All Rule Engines</option>
                <option value="Structural">Structural (XML/JSON/POM)</option>
                <option value="Environmental">Environmental (Properties/YAML)</option>
                <option value="Universal">Universal (Text/Token Search)</option>
                <option value="Project">Project Structure (Files/Folders)</option>
            </select>
            <select id="severityFilter">
                <option value="ALL">All Severities</option>
                <option value="HIGH">High</option>
                <option value="MEDIUM">Medium</option>
                <option value="LOW">Low</option>
            </select>
        </div>
    </div>

    <div id="grid" class="rules-grid">
        <!-- Rules will be injected here -->
    </div>
</div>

<script>
    // Init
    const rules = AEGIS_RULES_DATA.rules || [];
    const grid = document.getElementById('grid');
    const searchInput = document.getElementById('searchInput');
    const typeFilter = document.getElementById('typeFilter');
    const severityFilter = document.getElementById('severityFilter');
    
    // Simple HTML escaper for code blocks
    function escapeHtml(text) {
        if (!text) return '';
        return text
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }

    // --- Config Generator Logic ---
    let selectedRules = new Set();
    
    // Header controls
    const headerControls = document.createElement('div');
    headerControls.className = 'header-controls';
    headerControls.style.marginBottom = '1rem';
    headerControls.innerHTML = `
        <button id="selectAllBtn" class="btn-config">Select All</button>
        <button id="deselectAllBtn" class="btn-config">Deselect All</button>
        <button id="generateConfigBtn" class="btn-primary" style="margin-left:auto;">Generate Aegis Config</button>
    `;
    document.querySelector('.controls').after(headerControls);
    
    // CSS for buttons
    const style = document.createElement('style');
    style.innerHTML = `
        .btn-config { padding: 0.5rem 1rem; margin-right: 0.5rem; cursor: pointer; background: #fff; border: 1px solid #ccc; border-radius: 4px; }
        .btn-config:hover { background: #f0f0f0; }
        .btn-primary { padding: 0.5rem 1rem; cursor: pointer; background: var(--primary); color: white; border: none; border-radius: 4px; font-weight: bold; }
        .btn-primary:hover { background: var(--primary-light); }
        .rule-checkbox { 
            position: absolute; 
            top: 1rem; 
            right: 1rem; 
            width: 1.2rem; 
            height: 1.2rem; 
            cursor: pointer;
            accent-color: var(--primary);
        }
        .rule-card { position: relative; } /* Ensure absolute checkbox works */
    `;
    document.head.appendChild(style);

    // Event Listeners
    document.getElementById('selectAllBtn').addEventListener('click', () => {
        rules.forEach(r => selectedRules.add(r.id));
        renderRules(getFilteredRules());
    });
    
    document.getElementById('deselectAllBtn').addEventListener('click', () => {
        selectedRules.clear();
        renderRules(getFilteredRules());
    });

    document.getElementById('generateConfigBtn').addEventListener('click', () => {
        const enabled = Array.from(selectedRules);
        const disabled = rules.filter(r => !selectedRules.has(r.id)).map(r => r.id);
        
        let output = `### Aegis Configuration\n# Generated on ${new Date().toLocaleDateString()}\n\n`;
        output += `# Enabled Rules: ${enabled.length}\n`;
        output += `# Disabled Rules: ${disabled.length}\n\n`;
        
        output += `rules:\n`;
        // We can either whitelist or blacklist. Usually enabling is default, so let's list disabled to be explicit? 
        // Or explicitly list enabled ones to correspond to the Dynamic Sequence order.
        
        if (disabled.length > 0) {
             output += `  disabled:\n`;
             disabled.forEach(id => output += `    - ${id}\n`);
        } else {
             output += `  # All rules enabled by default.\n`;
        }
        
        // Show modal or alert
        const modal = document.createElement('div');
        modal.style.position = 'fixed';
        modal.style.top = '0'; modal.style.left = '0'; modal.style.width='100%'; modal.style.height='100%';
        modal.style.background = 'rgba(0,0,0,0.5)';
        modal.style.display = 'flex'; modal.style.alignItems='center'; modal.style.justifyContent='center';
        modal.innerHTML = `
            <div style="background:white; padding:2rem; border-radius:8px; width:600px; max-width:90%;">
                <h2>Configuration Generated</h2>
                <p>Copy this into your <code>rules-config.yaml</code> or similar.</p>
                <textarea style="width:100%; height:300px; font-family:monospace; margin-bottom:1rem;">${output}</textarea>
                <button onclick="this.closest('div').parentElement.remove()" class="btn-primary">Close</button>
            </div>
        `;
        document.body.appendChild(modal);
    });

    function getRuleCategory(rule) {
        if (!rule.checks || rule.checks.length === 0) return 'Universal';
        const type = rule.checks[0].type;
        if (type.startsWith('XML_') || type.startsWith('JSON_') || type.startsWith('POM_')) return 'Structural';
        if (type.includes('PROPERTY') || type.includes('SUBSTRING') || type.includes('YAML')) return 'Environmental';
        if (type.includes('TOKEN') || type.includes('TEXT') || type.includes('SEARCH')) return 'Universal';
        if (type.includes('FILE_') || type.includes('PROJECT_')) return 'Project';
        return 'Universal';
    }

    // Determine current filtered set
    function getFilteredRules() {
        const term = searchInput.value.toLowerCase();
        const category = typeFilter.value;
        const sev = severityFilter.value;
        return rules.filter(r => {
            const matchesSearch = r.id.toLowerCase().includes(term) || 
                                  r.name.toLowerCase().includes(term) || 
                                  r.description.toLowerCase().includes(term);
            const matchesType = category === 'ALL' || getRuleCategory(r) === category;
            const matchesSev = sev === 'ALL' || r.severity === sev;
            return matchesSearch && matchesType && matchesSev;
        });
    }

    // Init Logic
    rules.forEach(r => selectedRules.add(r.id)); // Default all selected

    function renderRules(filteredRules) {
        grid.innerHTML = '';
        
        if (filteredRules.length === 0) {
            grid.innerHTML = '<div class="no-results">No rules found matching your criteria.</div>';
            return;
        }

        filteredRules.forEach(rule => {
            const card = document.createElement('div');
            card.className = 'rule-card';
            
            const sevClass = rule.severity ? `sev-${rule.severity.toLowerCase()}` : '';
            
            // Generate tags HTML - Use descriptive categories
            const category = getRuleCategory(rule);
            let tagsHtml = `<span class="tag">${category}</span>`;
            if (rule.tags && rule.tags.length > 0) {
                tagsHtml += rule.tags.map(tag => `<span class="tag">${tag}</span>`).join('');
            }

            // Generate Content HTML
            const useCaseHtml = rule.useCase ? 
                `<div class="rule-use-case"><strong>üí° Use Case:</strong> ${rule.useCase}</div>` : '';

            // Detail sections
            let detailsHtml = '';
            
            if (rule.rationale) {
                detailsHtml += `<div class="section-title">Why it matters</div><div>${rule.rationale}</div>`;
            }

            if (rule.exampleBad) {
                detailsHtml += `<div class="section-title">‚ùå Don't do this</div><div class="code-block code-bad">${escapeHtml(rule.exampleBad)}</div>`;
            }
            
            if (rule.exampleGood) {
                detailsHtml += `<div class="section-title">‚úÖ Do this</div><div class="code-block code-good">${escapeHtml(rule.exampleGood)}</div>`;
            }
            
            if (rule.docLink) {
                 detailsHtml += `<a href="${rule.docLink}" target="_blank" class="doc-link">Read Official Documentation &rarr;</a>`;
            }
            
            if (detailsHtml) {
                detailsHtml = `<div class="rule-details">${detailsHtml}</div>`;
            }

            // Checkbox State
            const isChecked = selectedRules.has(rule.id) ? 'checked' : '';

            card.innerHTML = `
                <input type="checkbox" class="rule-checkbox" data-id="${rule.id}" ${isChecked} onclick="toggleRule('${rule.id}')" />
                <div class="rule-header">
                    <span class="rule-id">${rule.id}</span>
                    <span class="rule-severity ${sevClass}">${rule.severity || 'N/A'}</span>
                </div>
                <div class="rule-title">${rule.name}</div>
                <div class="rule-desc">${rule.description}</div>
                ${useCaseHtml}
                <div class="rule-tags">
                    ${tagsHtml}
                </div>
                ${detailsHtml}
            `;
            grid.appendChild(card);
        });
    }

    function toggleRule(id) {
        if (selectedRules.has(id)) {
            selectedRules.delete(id);
        } else {
            selectedRules.add(id);
        }
    }

    function filterRules() {
        const filtered = getFilteredRules();
        renderRules(filtered);
    }

    // Event Listeners
    searchInput.addEventListener('input', filterRules);
    typeFilter.addEventListener('change', filterRules);
    severityFilter.addEventListener('change', filterRules);

    // Initial Render
    renderRules(rules);

</script>

</body>
</html>
