<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Guide - GitAnalyzer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/styles.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>
<body class="bg-light guide-body">

    <div class="raks-full-screen">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-light brand-header mb-4">
            <div class="container-fluid position-relative">
                <a class="navbar-brand fw-bold d-flex align-items-center" href="index.html">
                    <img src="assets/images/logo.png" alt="Logo" width="40" height="40" class="d-inline-block align-text-top me-2">
                    ApiGuard Portal - GitAnalyzer
                </a>
                
                <!-- Centered Title -->
                <div class="position-absolute start-50 translate-middle-x d-none d-lg-block">
                    <h5 class="fw-bold text-purple mb-0">User Guide</h5>
                </div>

                <div class="d-flex">
                    <a href="index.html" class="btn btn-outline-light ghost-btn">Dashboard</a>
                </div>
            </div>
        </nav>
    
        <div class="container flex-grow-1 mb-5">
            <div class="row">
                <!-- Sidebar TOC -->
                <div class="col-md-3">
                    <div class="list-group guide-sidebar sticky-top" style="top: 2rem;">
                        <a href="#about" class="list-group-item list-group-item-action active">About GitAnalyzer</a>
                        <a href="#legend" class="list-group-item list-group-item-action">Status & Legend</a>
                        <a href="#analysis" class="list-group-item list-group-item-action">Analysis Tool</a>
                        <a href="#search" class="list-group-item list-group-item-action">Git Search</a>
                        <a href="#bulk" class="list-group-item list-group-item-action">Bulk Download</a>
                    </div>
                </div>
    
                <!-- Content -->
                <div class="col-md-9">
                    
                    <!-- About -->
                    <section id="about" class="raks-card mb-5">
                        <div class="d-flex align-items-center border-bottom pb-3 mb-4">
                            <i class="bi bi-gem text-purple fs-3 me-3"></i>
                            <h2 class="text-purple mb-0">Enterprise Semantic Analysis</h2>
                        </div>
                        <p class="lead text-dark">Don't just verify <em>code</em>. Verify <strong>Intent</strong>.</p>
                        <p class="text-muted">GitAnalyzer is a specialized auditing engine designed key migration and compliance challenges. It distinguishes between noise (formatting, reordering) and actual risk (logic changes, configuration drift), providing a crystal-clear view of your release readiness.</p>
                        
                        <div class="row g-4 mt-2">
                            <div class="col-md-4">
                                <div class="p-3 border rounded bg-light h-100">
                                    <h6 class="fw-bold text-dark"><i class="bi bi-diagram-3-fill text-purple me-2"></i>Multi-Repo Context</h6>
                                    <p class="small mb-0">Automatically pairs Code repositories with their configuration counterparts (e.g., `api-v1` + `api-v1_config`) to ensure holistic consistency.</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="p-3 border rounded bg-light h-100">
                                    <h6 class="fw-bold text-dark"><i class="bi bi-magic text-purple me-2"></i>Smart Semantics</h6>
                                    <p class="small mb-0">Compares XML logically for <code>.xml</code>, <code>.policy</code>, and <code>.mflow</code> files. Attributes order is ignored to eliminate noise.</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="p-3 border rounded bg-light h-100">
                                    <h6 class="fw-bold text-dark"><i class="bi bi-shield-check text-purple me-2"></i>Audit Ready</h6>
                                    <p class="small mb-0">Generates immutable, severity-classified reports. Perfect for Change Advisory Board (CAB) reviews.</p>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Workflow -->
                    <section id="analysis" class="raks-card mb-5">
                        <div class="d-flex align-items-center border-bottom pb-3 mb-4">
                            <i class="bi bi-cpu text-purple fs-3 me-3"></i>
                            <h3 class="text-purple mb-0">Comparison Workflow</h3>
                        </div>
                        
                        <div class="timeline ps-3 border-start border-purple border-3">
                            <div class="mb-4 ps-3">
                                <h5 class="fw-bold"><span class="badge bg-purple rounded-circle me-2">1</span>Repository Discovery</h5>
                                <p>GitAnalyzer intelligently scans your environment to build a workspace.</p>
                                <ul class="list-unstyled small">
                                    <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i><strong>Auto-Fetch:</strong> Retrieves all repositories from your configured group or local directory.</li>
                                    <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i><strong>Smart Pairing:</strong> When you select a main repo (e.g., `order-api`), the tool automatically hunts for a config repo (e.g., `order-api_config`) and pre-selects it.</li>
                                    <li><i class="bi bi-check-circle text-success me-2"></i><strong>Branch Sync:</strong> Fetches all active branches for both repositories simultaneously.</li>
                                </ul>
                            </div>
                            
                            <div class="mb-4 ps-3">
                                <h5 class="fw-bold"><span class="badge bg-purple rounded-circle me-2">2</span>Noise Reduction Strategy</h5>
                                <p>Configure <em>how</em> the comparison engine perceives differences. This is the core power of GitAnalyzer.</p>
                                
                                <div class="card border-0 bg-light mb-3">
                                    <div class="card-body">
                                        <h6 class="fw-bold text-purple"><i class="bi bi-file-earmark-x me-2"></i>Mode A: File Exclusions</h6>
                                        <p class="small mb-2">Completely ignore files that don't matter for the audit.</p>
                                        <div class="bg-white p-2 border rounded font-monospace small">
                                            *.md, *.txt, .gitignore, src/test/**
                                        </div>
                                    </div>
                                </div>

                                <div class="card border-0 bg-light mb-3">
                                    <div class="card-body">
                                        <h6 class="fw-bold text-purple"><i class="bi bi-regex me-2"></i>Mode B: Content Filters</h6>
                                        <p class="small">Ignore specific lines within valid files. Useful for timestamps, dynamic IDs, or logs.</p>
                                        <table class="table table-sm table-borderless small mb-0">
                                            <tr>
                                                <td width="120"><strong>Plain Text</strong></td>
                                                <td><code>DEBUG_LOG</code></td>
                                                <td class="text-muted">Ignores any line containing "DEBUG_LOG".</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Strict Regex</strong></td>
                                                <td><code>regex:^//.*</code></td>
                                                <td class="text-muted">Matches lines starting with `//` (Comments).</td>
                                            </tr>
                                            <tr>
                                                <td width="120"><strong>Wildcard Regex</strong></td>
                                                <td><code>regex:.*guid.*</code></td>
                                                <td class="text-muted">Matches any line containing "guid". Note the `.*` to match the full line.</td>
                                            </tr>
                                            <!-- New Examples requested by User -->
                                            <tr class="table-light border-top border-bottom">
                                                <td colspan="3" class="fw-bold text-purple pt-3 pb-2"><i class="bi bi-lightbulb me-2"></i>Advanced Strict Regex Scenarios</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Ignore Log Lines</strong></td>
                                                <td><code>regex:^\s*logger\.(info|debug|error).*</code></td>
                                                <td class="text-muted">Matches lines starting with logger calls (e.g., <code>logger.info("Test");</code>).</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Exclude Class</strong></td>
                                                <td><code>regex:public class Test.*</code></td>
                                                <td class="text-muted">Matches definition of test classes to ignore specific structural changes.</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Mask Secrets</strong></td>
                                                <td><code>regex:(?i).*(password|secret|key)\s*=.*</code></td>
                                                <td class="text-muted">Matches any line assigning values to sensitive variables (case-insensitive).</td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>

                                 <div class="card border-0 bg-light">
                                    <div class="card-body">
                                        <h6 class="fw-bold text-purple"><i class="bi bi-code-square me-2"></i>Mode C: Smart XML Compare</h6>
                                        <p class="small mb-1">Unlike text diffs, this mode parses XML structure. It recognizes that <code>attributeOrder="irrelevant"</code>.</p>
                                        <p class="x-small text-muted mb-0"><strong>Supported:</strong> Mule Flow (`.mflow`), Policy (`.policy`), and standard `.xml`/`.xapi` files.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
    
                    <!-- Legend -->
                    <section id="legend" class="raks-card mb-5">
                        <div class="d-flex align-items-center border-bottom pb-3 mb-4">
                            <i class="bi bi-palette text-purple fs-3 me-3"></i>
                            <h3 class="text-purple mb-0">Visual Intelligence</h3>
                        </div>
                        <p>The Results Panel is packed with interactive data.</p>
                        
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="card h-100 shadow-sm border-0">
                                    <div class="card-header bg-white fw-bold">Identification Badges</div>
                                    <div class="card-body">
                                        <ul class="list-group list-group-flush small">
                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                Logic / Source Code
                                                <span class="badge bg-code">CODE</span>
                                            </li>
                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                Configuration Files
                                                <span class="badge bg-config">CONFIG</span>
                                            </li>
                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                High Risk Change
                                                <span class="badge bg-critical">CRITICAL</span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card h-100 shadow-sm border-0">
                                    <div class="card-header bg-white fw-bold">Interactive Features</div>
                                    <div class="card-body small">
                                        <dl class="row mb-0">
                                            <dt class="col-sm-4"><i class="bi bi-eye text-primary"></i> Live Preview</dt>
                                            <dd class="col-sm-8">Hover over the <strong>View</strong> button to see a quick diff snippet without leaving the page.</dd>
                                            
                                             <dt class="col-sm-4"><i class="bi bi-funnel text-warning"></i> Filter Badges</dt>
                                            <dd class="col-sm-8">Displays exactly <em>why</em> content was ignored. Supports simultaneous filters: <span class="badge" style="background-color: #6f42c1; font-size: 0.7em;">Smart XML</span> + <span class="badge bg-secondary" style="font-size: 0.7em;">Content Filter</span>.</dd>
                                            
                                            <dt class="col-sm-4"><i class="bi bi-search text-secondary"></i> Unified Diff</dt>
                                            <dd class="col-sm-8">Click <strong>View</strong> to open the full side-by-side Unified Diff, preserving context while highlighting changes.</dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
    
                    <!-- Search & Bulk -->
                    <section id="search" class="raks-card mb-5">
                       <div class="row">
                           <div class="col-md-6">
                               <h4 class="text-purple mb-3"><i class="bi bi-search me-2"></i>Git Search</h4>
                               <p class="small">Perform regex-based forensic searches across your entire landscape.</p>
                               <ul class="list-unstyled x-small">
                                   <li class="mb-1 text-muted"><i class="bi bi-bookmark-check me-2"></i><strong>Session Stickiness:</strong> Remembers your last search, layout, and filters.</li>
                                   <li class="mb-1 text-muted"><i class="bi bi-link-45deg me-2"></i><strong>Git Links:</strong> Accurate "View on Git" support for nested GitHub/GitLab paths.</li>
                               </ul>
                           </div>
                           <div class="col-md-6 border-start">
                               <h4 class="text-purple mb-3"><i class="bi bi-cloud-download me-2"></i>Bulk Download</h4>
                               <p class="small">Rapidly onboard workspaces. Download specific groups or regex-matched repositories in bulk to prepare for offline analysis.</p>
                           </div>
                       </div>
                    </section>
    
                    <br><hr>
                    <h2 id="contact">ðŸ“§ Contact</h2>
                    <div style="border-left: 5px solid #663399; padding-left: 20px; background: #f9f9f9; padding-top: 15px; padding-bottom: 15px; margin-top: 20px; border-radius: 0 5px 5px 0; border-bottom: 1px solid #eee; border-right: 1px solid #eee; border-top: 1px solid #eee;">
                        <p style="margin: 0; font-weight: bold; color: #333; font-size: 1.1em;">For further information, support, or questions:</p>
                        <p style="margin: 10px 0 5px 0; color: #555;">Reach out to <strong>Rakesh Kumar (Raks)</strong></p>
                        <p style="margin: 0; color: #555;">Email: <a href="mailto:rakesh.kumar@ibm.com" style="color: #663399; font-weight: bold; text-decoration: none;">rakesh.kumar@ibm.com</a></p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="raks-footer text-center mt-auto">
             <div class="container" id="footerText">
                &copy; 2018 RAKS - Enterprise API Solution Suite - ApiGuard
            </div>
        </footer>
    </div>
    
    <script>
        fetch('/api/config/ui').then(r=>r.json()).then(c=>{
            if(c['ui.footer.text']) document.getElementById('footerText').innerText=c['ui.footer.text'];
        });

        // Force Scroll to Top on Load (ignores hash)
        window.addEventListener('load', function() {
            setTimeout(() => {
                const container = document.querySelector('.container.flex-grow-1');
                if(container) container.scrollTop = 0;
                window.scrollTo(0, 0);
            }, 10);
        });
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Fetch UI Config
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/api/config/ui')
                .then(response => response.json())
                .then(config => {
                    // Update Header Title if specific guide property exists, or fallback
                    if (config['ui.header.guide']) {
                        const headerTitle = document.querySelector('.navbar .position-absolute h5');
                        if (headerTitle) headerTitle.textContent = config['ui.header.guide'];
                    }
                    if (config['ui.header.guide']) {
                         document.title = config['ui.header.guide'] + " - GitAnalyzer";
                    }
                })
                .catch(err => console.error('Error loading UI config:', err));
        });
    </script>
</body>
</html>
